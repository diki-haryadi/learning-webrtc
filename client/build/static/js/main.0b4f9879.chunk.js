(this["webpackJsonpion-sfu-client"]=this["webpackJsonpion-sfu-client"]||[]).push([[0],{17:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n.n(r),a=n(11),o=n.n(a),i=(n(17),n(4)),s=n(12),u=n(3),l=n.n(u),d=n(5),f=n(6),b=n(9),v=n(10),j=n(1),x=function(e){var t=e.setSenderStreamID,n=Object(r.useRef)(null),c=Object(r.useRef)(),a=Object(r.useRef)(),o=Object(r.useState)(!1),u=Object(i.a)(o,2),x=u[0],p=u[1],g=Object(r.useState)(!1),m=Object(i.a)(g,2),O=m[0],h=m[1],w=Object(r.useState)(),y=Object(i.a)(w,2),k=y[0],S=y[1],N=Object(r.useState)("new"),C=Object(i.a)(N,2),D=C[0],I=C[1],R=Object(r.useCallback)((function(e){n.current&&(n.current.srcObject=e,t(e.id))}),[n,t]);Object(r.useEffect)((function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(R).catch(console.error)}),[R]);var T={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]},J=function(){var e=Object(d.a)(l.a.mark((function e(){var t,r,o,i,u,f,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I("connecting"),n.current){e.next=3;break}return e.abrupt("return");case 3:if(c.current=new WebSocket("ws://127.0.0.1:7000/ws"),c.current.onopen=function(){return console.log("connection opened")},c.current.onmessage=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("answer"!==(n=JSON.parse(t.data)).type){e.next=5;break}return e.next=4,null===(r=a.current)||void 0===r?void 0:r.setRemoteDescription(n);case 4:console.log("set-remote-description");case 5:if(!n.candidate||0!==n.target){e.next=9;break}return e.next=8,null===(c=a.current)||void 0===c?void 0:c.addIceCandidate(n.candidate);case 8:console.log("add-ice-candidate");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.current=new RTCPeerConnection(T),a.current.onconnectionstatechange=function(){var e,t;console.log("state: ",null===(e=a.current)||void 0===e?void 0:e.connectionState),I((null===(t=a.current)||void 0===t?void 0:t.connectionState)||"new")},a.current.onnegotiationneeded=Object(d.a)(l.a.mark((function e(){var t,n,r,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("negotiation is needed"),(null===(t=c.current)||void 0===t?void 0:t.readyState)!==WebSocket.OPEN){e.next=9;break}return e.next=4,null===(n=a.current)||void 0===n?void 0:n.createOffer();case 4:if(!(r=e.sent)){e.next=9;break}return e.next=8,null===(o=a.current)||void 0===o?void 0:o.setLocalDescription(r);case 8:null===(i=c.current)||void 0===i||i.send(JSON.stringify({type:"offer",data:r.sdp}));case 9:case"end":return e.stop()}}),e)}))),a.current.onicecandidate=function(e){var t;(console.log("oniceCandiate Sender Called",c.current),e.candidate&&"connected"===D)&&(null===(t=c.current)||void 0===t||t.send(JSON.stringify({type:"tricle",data:JSON.stringify({target:0,candidates:e.candidate})})))},r=null===(t=n.current)||void 0===t?void 0:t.srcObject){o=Object(s.a)(r.getTracks());try{for(o.s();!(i=o.n()).done;)f=i.value,console.log("adding tracks..."),null===(u=a.current)||void 0===u||u.addTrack(f,r)}catch(v){o.e(v)}finally{o.f()}}return console.log("offer created"),e.next=15,a.current.createOffer();case 15:b=e.sent,a.current.setLocalDescription(b),setTimeout((function(){var e;null===(e=c.current)||void 0===e||e.send(JSON.stringify({type:"offer",data:b.sdp}))}),2e3);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e,t,n=null===(e=a.current)||void 0===e?void 0:e.getSenders().find((function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.id)===(null===k||void 0===k?void 0:k.id)}));n&&(null===(t=a.current)||void 0===t||t.removeTrack(n));S(void 0)},P=function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=4;break}return null===k||void 0===k||k.stop(),E(),e.abrupt("return");case 4:return e.prev=4,e.next=7,navigator.mediaDevices.getDisplayMedia();case 7:return n=e.sent,r=n.getTracks(),S(r[0]),r[0].onended=E,e.next=13,null===(t=a.current)||void 0===t?void 0:t.addTrack(r[0],n);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),console.log(e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{className:"w-full h-full",children:[Object(j.jsx)("video",{className:"object-cover h-full w-full",autoPlay:!0,muted:!0,ref:n}),["new","disconnected","failed"].includes(D)&&Object(j.jsx)("button",{className:"bg-blue-700 absolute bottom-5 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white max-h-10 max-w-52 rounded-md px-5 py-2",onClick:J,children:"JOIN"}),"connecting"===D&&Object(j.jsx)("p",{className:"absolute bottom-5 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white max-h-10 max-w-52 rounded-md px-5 py-2",children:"connecting..."}),"connected"===D&&Object(j.jsxs)("div",{className:"absolute bottom-5 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-row",children:[Object(j.jsx)("button",{className:"".concat(O?"bg-red-700":"bg-gray-800"," transition duration-500 text-white max-h-10 max-w-52 rounded-md px-5 py-2"),onClick:function(){var e;(null===(e=n.current)||void 0===e?void 0:e.srcObject).getAudioTracks().forEach((function(e){return e.enabled=!e.enabled})),h((function(e){return!e}))},children:O?Object(j.jsx)(f.c,{}):Object(j.jsx)(f.b,{})}),Object(j.jsx)("button",{className:"".concat(x?"bg-red-700":"bg-gray-800"," transition duration-500  ml-2 text-white max-h-10 max-w-52 rounded-md px-5 py-2"),onClick:function(){var e;(null===(e=n.current)||void 0===e?void 0:e.srcObject).getVideoTracks().forEach((function(e){return e.enabled=!e.enabled})),p((function(e){return!e}))},children:x?Object(j.jsx)(b.b,{}):Object(j.jsx)(b.a,{})}),Object(j.jsx)("button",{onClick:P,className:"".concat(k?"bg-gray-800":"bg-red-800"," transition duration-500  ml-2 text-white max-h-10 max-w-52 rounded-md px-5 py-2"),children:k?Object(j.jsx)(v.a,{}):Object(j.jsx)(v.b,{})})]})]})},p=function(e){var t=e.senderStreamID,n=Object(r.useRef)(),c=Object(r.useRef)(),a=Object(r.useState)([]),o=Object(i.a)(a,2),s=o[0],u=o[1],b=Object(r.useState)(null),v=Object(i.a)(b,2),x=v[0],p=v[1];Object(r.useEffect)((function(){y()}),[]);var m=Object(r.useState)(),O=Object(i.a)(m,2),h=O[0],w=O[1],y=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.current=new WebSocket("ws://127.0.0.1:7000/ws"),c.current=new RTCPeerConnection,n.current.onopen=function(){return console.log("connection opened")},n.current.onmessage=function(){var e=Object(d.a)(l.a.mark((function e(t){var r,a,o,i,s,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("offer"!==(r=JSON.parse(t.data)).type){e.next=13;break}return e.next=4,null===(a=c.current)||void 0===a?void 0:a.setRemoteDescription(r);case 4:return e.next=6,null===(o=c.current)||void 0===o?void 0:o.createAnswer();case 6:if(!(i=e.sent)){e.next=12;break}return e.next=10,null===(s=c.current)||void 0===s?void 0:s.setLocalDescription(i);case 10:return e.next=12,null===(u=n.current)||void 0===u?void 0:u.send(JSON.stringify({type:"answer",data:i.sdp}));case 12:console.log("set-remote-description");case 13:r.candidate&&1===r.target&&(null===(d=c.current)||void 0===d||d.addIceCandidate(r.candidate),console.log("add-ice-candidate"));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.current.onconnectionstatechange=function(){var e,t;console.log("state: ",null===(e=c.current)||void 0===e?void 0:e.connectionState),w(null===(t=c.current)||void 0===t?void 0:t.connectionState)},c.current.ontrack=function(e){console.log("got-streams: ",e.streams),e.streams[0].onremovetrack=function(){console.log("onremove track"),u((function(t){return t.filter((function(t){return t.id!==e.streams[0].id}))}))},u((function(t){return 1===e.streams.length&&e.streams[0].active&&-1===t.map((function(e){return e.id})).indexOf(e.streams[0].id)&&t.push(e.streams[0]),t}))},c.current.onicecandidate=function(e){var t;e.candidate&&(null===(t=n.current)||void 0===t||t.send(JSON.stringify({type:"tricle",data:JSON.stringify({target:1,candidates:e.candidate})})))};case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{className:"grid grid-cols-3 gap-x-10 gap-y-10 p-20",children:["connected"!==h&&Object(j.jsx)("p",{className:"fixed right-1/2 top-1/2 transform translate-x-1/2 -translate-y-1/2 text-white",children:"RETREIVING VIDEOS..."}),s.filter((function(e){return e.id!==t&&e.active})).map((function(e,t){return Object(j.jsxs)("div",{className:" rounded-3xl overflow-hidden bg-gray-900 group transition duration-500 ".concat(x===e?"max-h-screen fixed left-0 top-0 h-screen w-screen":"relative w-full h-full max-h-96"),children:[Object(j.jsx)(g,{srcObject:e}),Object(j.jsxs)("p",{className:"absolute text-white top-0 left-3",children:["FRIEND ",t+1]}),Object(j.jsx)("p",{className:"cursor-pointer absolute text-white top-1/2 bg-gray-800 px-2 left-1/2 text-2xl hidden group-hover:block ",onClick:function(){return p(x?null:e)},children:Object(j.jsx)(f.a,{})})]},e.id)}))]})},g=function(e){var t=e.srcObject,n=Object(r.useRef)(null);return Object(r.useEffect)((function(){t&&n.current&&(n.current.srcObject=t)}),[t]),t.active?Object(j.jsx)("video",{autoPlay:!0,ref:n,className:"object-cover w-full h-full"}):null};var m=function(){var e=Object(r.useState)(),t=Object(i.a)(e,2),n=t[0],c=t[1];return Object(j.jsxs)("div",{className:"bg-gray-800 min-h-screen overflow-auto",children:[Object(j.jsx)("div",{className:"bg-gray-500 w-72 h-72 rounded-full fixed right-10 bottom-10 overflow-hidden z-10",children:Object(j.jsx)(x,{setSenderStreamID:c})}),Object(j.jsx)("div",{className:"relative",children:Object(j.jsx)(p,{senderStreamID:n})})]})},O=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};o.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(m,{})}),document.getElementById("root")),O()}},[[20,1,2]]]);
//# sourceMappingURL=main.0b4f9879.chunk.js.map